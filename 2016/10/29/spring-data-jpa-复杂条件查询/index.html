<!doctype html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="spring,spring data jpa," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="使用 spring data jpa 封装的任意条件查询，可使用Pageable定义分页和排序。
一般方式定义接口，继承JpaRepository和JpaSpecificationExecutor。dao支持可以继承JpaRepository，条件查询可以继承JpaSpecificationExecutor。
12@(spring data jpa)Repository(&quot;resultInfoRe">
<meta property="og:type" content="article">
<meta property="og:title" content="spring data jpa 复杂条件查询">
<meta property="og:url" content="http://leileiyuan.top/2016/10/29/spring-data-jpa-复杂条件查询/index.html">
<meta property="og:site_name" content="Hope you never grow old">
<meta property="og:description" content="使用 spring data jpa 封装的任意条件查询，可使用Pageable定义分页和排序。
一般方式定义接口，继承JpaRepository和JpaSpecificationExecutor。dao支持可以继承JpaRepository，条件查询可以继承JpaSpecificationExecutor。
12@(spring data jpa)Repository(&quot;resultInfoRe">
<meta property="og:updated_time" content="2016-12-29T15:03:32.835Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="spring data jpa 复杂条件查询">
<meta name="twitter:description" content="使用 spring data jpa 封装的任意条件查询，可使用Pageable定义分页和排序。
一般方式定义接口，继承JpaRepository和JpaSpecificationExecutor。dao支持可以继承JpaRepository，条件查询可以继承JpaSpecificationExecutor。
12@(spring data jpa)Repository(&quot;resultInfoRe">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://leileiyuan.top/2016/10/29/spring-data-jpa-复杂条件查询/"/>





  <title> spring data jpa 复杂条件查询 | Hope you never grow old </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Hope you never grow old</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup">
 <span class="search-icon fa fa-search"></span>
 <input type="text" id="local-search-input">
 <div id="local-search-result"></div>
 <span class="popup-btn-close">close</span>
</div>


    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://leileiyuan.top/2016/10/29/spring-data-jpa-复杂条件查询/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="leileiyuan">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/wf.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Hope you never grow old">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Hope you never grow old" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                spring data jpa 复杂条件查询
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-10-29T00:28:21+08:00">
                2016-10-29
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/spring-dta-jpa/" itemprop="url" rel="index">
                    <span itemprop="name">spring dta jpa</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <a href="/2016/10/29/spring-data-jpa-复杂条件查询/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/10/29/spring-data-jpa-复杂条件查询/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2016/10/29/spring-data-jpa-复杂条件查询/" class="leancloud_visitors" data-flag-title="spring data jpa 复杂条件查询">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>使用 <code>spring data jpa</code> 封装的任意条件查询，可使用<code>Pageable</code>定义分页和排序。</p>
<h3 id="一般方式"><a href="#一般方式" class="headerlink" title="一般方式"></a>一般方式</h3><p>定义接口，继承<code>JpaRepository</code>和<code>JpaSpecificationExecutor</code>。dao支持可以继承<code>JpaRepository</code>，条件查询可以继承<code>JpaSpecificationExecutor</code>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">@(spring data jpa)Repository(<span class="string">"resultInfoReposintory"</span>)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ResultInfoReposintory</span> <span class="keyword">extends</span> <span class="title">JpaRepository</span>&lt;<span class="title">ResultInfo</span>,<span class="title">Long</span>&gt;,<span class="title">JpaSpecificationExecutor</span>&lt;<span class="title">ResultInfo</span>&gt;</span></div></pre></td></tr></table></figure>
<p><code>JpaSpecificationExecutor</code>接口其中的两个方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="function">List&lt;T&gt; <span class="title">findAll</span><span class="params">(Specification&lt;T&gt; spec)</span></span>;	<span class="comment">// 条件查询，不分页</span></div><div class="line"><span class="function">Page&lt;T&gt; <span class="title">findAll</span><span class="params">(Specification&lt;T&gt; spec, Pageable pageable)</span></span>;	<span class="comment">// 条件查询，分页和排序</span></div></pre></td></tr></table></figure>
<p>代码实例</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 构建Pageable对象，用于分页和排序</span></div><div class="line"><span class="keyword">int</span> page = <span class="number">0</span>;	  	  <span class="comment">// 当前页</span></div><div class="line"><span class="keyword">int</span> pageSize = <span class="number">20</span>;	  <span class="comment">// 每页显示多少条</span></div><div class="line"><span class="comment">// 排序条件，以创建时间，更新时间 降序</span></div><div class="line">List&lt;Order&gt; orders = <span class="keyword">new</span> ArrayList&lt;Sort.Order&gt;();</div><div class="line">orders.add(<span class="keyword">new</span> Order(Direction.DESC, <span class="string">"createTime"</span>));	<span class="comment">//createTime是ResultInfo实体中的属性名</span></div><div class="line">orders.add(<span class="keyword">new</span> Order(Direction.DESC, <span class="string">"modifyTime"</span>));</div><div class="line">Pageable pageable = <span class="keyword">new</span> PageRequest(page,pageSize,<span class="keyword">new</span> Sort(orders));</div><div class="line"></div><div class="line"><span class="comment">// 构建查询条件对象 specification</span></div><div class="line">Specification&lt;ResultInfo&gt; specification = <span class="keyword">this</span>.getSpecification(accNo, beginDate, endDate);</div><div class="line"></div><div class="line"><span class="comment">// 执行分页查询</span></div><div class="line">Page&lt;ResultInfo&gt; page = resultInfoRepository.findAll(specification, pageable);</div></pre></td></tr></table></figure>
<p>构建查询条件的方法。使用<code>CriteriaQuery</code>得到查询条件</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 构建查询条件</span></div><div class="line"><span class="comment">// root.get("accNo")中的accNo和 root.get("transDate")中的transDate，都是实体类中的属性名</span></div><div class="line"><span class="function"><span class="keyword">private</span> Specification&lt;ResultInfo&gt; <span class="title">getSpecification</span><span class="params">(<span class="keyword">final</span> String accNo, <span class="keyword">final</span> String beginDate, <span class="keyword">final</span> String endDate)</span></span>&#123;</div><div class="line">	Specification&lt;ResultInfo&gt; specification = <span class="keyword">new</span> Specification&lt;ResultInfo&gt;() &#123;</div><div class="line">		<span class="meta">@Override</span></div><div class="line">		<span class="function"><span class="keyword">public</span> Predicate <span class="title">toPredicate</span><span class="params">(Root&lt;ResultInfo&gt; root, CriteriaQuery&lt;?&gt; query, CriteriaBuilder cb)</span> </span>&#123;</div><div class="line">			<span class="comment">// 存储 多个在查询条件</span></div><div class="line">			List&lt;Predicate&gt; list = <span class="keyword">new</span> ArrayList&lt;Predicate&gt;(); </div><div class="line">			</div><div class="line">			list.add(cb.equal(root.get(<span class="string">"accNo"</span>).as(String.class), accNo));</div><div class="line">			</div><div class="line">			Date begin = DateUtil.str2Date(beginDate, DateUtil.FORMAT_YYYY_MM_DD);</div><div class="line">			Date end = DateUtil.str2Date(beginDate, DateUtil.FORMAT_YYYY_MM_DD);</div><div class="line">			<span class="keyword">if</span>(begin != <span class="keyword">null</span> &amp;&amp; end != <span class="keyword">null</span>)&#123;</div><div class="line">				<span class="comment">// 交易日期</span></div><div class="line">				list.add(cb.between(root.get(<span class="string">"transDate"</span>).as(Date.class), begin, end));</div><div class="line">			&#125;</div><div class="line">			Predicate[] p = <span class="keyword">new</span> Predicate[list.size()];</div><div class="line"></div><div class="line">				<span class="keyword">return</span> query.where(list.toArray(p)).getRestriction();</div><div class="line">		&#125;</div><div class="line">	&#125;;</div><div class="line">	<span class="keyword">return</span> specification;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>也可以使用<code>CriteriaBuilder</code>得到查询条件。下面代码的<code>cb</code>即是<code>CriteriaBuilder</code>的实例对象</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Predicate[] p = <span class="keyword">new</span> Predicate[list.size()];</div><div class="line"><span class="keyword">return</span> cb.and(list.toArray(p));</div></pre></td></tr></table></figure>
<p>最后会得到一个<code>Page&lt;T&gt;</code>对象实例，保存数据和分页信息。<br><code>Page&lt;ResultInfo&gt; page = resultInfoRepository.findAll(specification, pageable);</code><br>Page接口中的方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">getNumber</span><span class="params">()</span></span>;			<span class="comment">// 当前页，第一页是0</span></div><div class="line"><span class="function"><span class="keyword">long</span> <span class="title">getTotalElements</span><span class="params">()</span></span>;	<span class="comment">// 总记录数</span></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">getSize</span><span class="params">()</span></span>;				<span class="comment">// 每页显示多少条</span></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">getTotalPages</span><span class="params">()</span></span>;		<span class="comment">// 总页数</span></div><div class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">isLast</span><span class="params">()</span></span>;			<span class="comment">// 是否是最后一页</span></div><div class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">isFirst</span><span class="params">()</span></span>;			<span class="comment">// 是否是第一页</span></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">getNumberOfElements</span><span class="params">()</span></span>;	<span class="comment">// 当前页的记录条数</span></div><div class="line"><span class="function">List&lt;T&gt; <span class="title">getContent</span><span class="params">()</span></span>;		<span class="comment">// 当前页的记录集合</span></div></pre></td></tr></table></figure>
<h3 id="自行封装"><a href="#自行封装" class="headerlink" title="自行封装"></a>自行封装</h3><p>构建复杂的查询条件</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/** </span></div><div class="line"> * <span class="doctag">@Description</span> </div><div class="line"> * <span class="doctag">@author</span> leileiyuan</div><div class="line"> * <span class="doctag">@date</span> 2016年11月28日 上午10:11:26 </div><div class="line">*/</div><div class="line"><span class="meta">@Service</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EnterpriseServiceImpl</span></span>&#123;</div><div class="line">	<span class="meta">@Autowired</span></div><div class="line">	<span class="keyword">private</span> EnterpriseRepository enterpriseRepository;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> Page&lt;Enterprise&gt; <span class="title">queryEnterpriseInfo</span><span class="params">(Enterprise enterprise)</span> </span>&#123;</div><div class="line">		<span class="comment">// 构建Pageable对象，用于分页和排序</span></div><div class="line">		<span class="keyword">int</span> page = <span class="number">0</span>;	  	  <span class="comment">// 当前页</span></div><div class="line">		<span class="keyword">int</span> pageSize = <span class="number">20</span>;	  <span class="comment">// 每页显示多少条</span></div><div class="line">		<span class="comment">// 排序条件，以创建时间，更新时间 降序</span></div><div class="line">		List&lt;Order&gt; orders = <span class="keyword">new</span> ArrayList&lt;Sort.Order&gt;();</div><div class="line">		orders.add(<span class="keyword">new</span> Order(Direction.DESC, <span class="string">"createTime"</span>));	<span class="comment">//createTime是Enterprise实体中的属性名</span></div><div class="line">		orders.add(<span class="keyword">new</span> Order(Direction.DESC, <span class="string">"modifyTime"</span>));</div><div class="line">		Pageable pageable = <span class="keyword">new</span> PageRequest(page,pageSize,<span class="keyword">new</span> Sort(orders));</div><div class="line">		</div><div class="line">		<span class="comment">// 构建查询条件，我们已经把请求的查询条件放在入参 enterprise中，</span></div><div class="line">		Criteria&lt;Enterprise&gt; spec = <span class="keyword">this</span>.getSpecifications(enterprise);</div><div class="line">		</div><div class="line">		Page&lt;Enterprise&gt; data = enterpriseRepository.findAll(spec, pageable);</div><div class="line">		<span class="keyword">return</span> data;</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="comment">// 建构查询条件</span></div><div class="line">	<span class="function"><span class="keyword">private</span> Criteria&lt;Enterprise&gt; <span class="title">getSpecifications</span><span class="params">(Enterprise enterprise)</span> </span>&#123;</div><div class="line">		Criteria&lt;Enterprise&gt; criteria = <span class="keyword">new</span> Criteria&lt;Enterprise&gt;();</div><div class="line">		<span class="comment">// 默认条件 </span></div><div class="line">		<span class="comment">// 企业状态为“正常”和“已到期”并且</span></div><div class="line">		List&lt;String&gt; eStatus = <span class="keyword">new</span> ArrayList&lt;String&gt;();</div><div class="line">		eStatus.add(EnterpriseStatusEnum.normal.getValue());</div><div class="line">		<span class="comment">//eStatus.add(EnterpriseStatusEnum.overDue.getValue());</span></div><div class="line">		criteria.add(Restrictions.in(<span class="string">"eStatus"</span>, eStatus));							<span class="comment">// 企业状态  为 正常和已到期</span></div><div class="line">		<span class="comment">// 审核状态为“风控审核通过”的</span></div><div class="line">		List&lt;String&gt; chkStatus = <span class="keyword">new</span> ArrayList&lt;String&gt;();</div><div class="line">		chkStatus.add(OperationAuditStatusEnum.chkStatus4.getValue());</div><div class="line">		chkStatus.add(enterprise.getChkStatus());									<span class="comment">// 审核状态</span></div><div class="line">		criteria.add(Restrictions.in(<span class="string">"chkStatus"</span>, chkStatus));									</div><div class="line">		</div><div class="line">		criteria.add(Restrictions.like(<span class="string">"eId"</span>, enterprise.getEId()));				<span class="comment">// 企业编号</span></div><div class="line">		criteria.add(Restrictions.like(<span class="string">"eName"</span>, enterprise.getEName()));			<span class="comment">// 企业名称</span></div><div class="line">		<span class="comment">// 入网开始时间 - 入网结束时间</span></div><div class="line">		Date joinDateBegin = enterprise.getJoinDateBegin();</div><div class="line">		Date joinDateEnd = enterprise.getJoinDateEnd();</div><div class="line">		<span class="keyword">if</span>(joinDateBegin!=<span class="keyword">null</span> &amp;&amp; joinDateEnd!=<span class="keyword">null</span>)&#123;</div><div class="line">			criteria.add(Restrictions.between(<span class="string">"joinDate"</span>,joinDateBegin, joinDateEnd));</div><div class="line">		&#125;</div><div class="line">		<span class="comment">// 到期开始时间 - 到期结束时间</span></div><div class="line">		Date eDueDateBegin = enterprise.geteDueDateBegin();</div><div class="line">		Date eDueDateEnd = enterprise.geteDueDateEnd();</div><div class="line">		<span class="keyword">if</span>(eDueDateBegin!=<span class="keyword">null</span> &amp;&amp; eDueDateEnd!=<span class="keyword">null</span>)&#123;</div><div class="line">			criteria.add(Restrictions.between(<span class="string">"eDueDate"</span>, eDueDateBegin,eDueDateEnd));</div><div class="line">		&#125;</div><div class="line">		criteria.add(Restrictions.equal(<span class="string">"eStatus"</span>, enterprise.getEStatus()));		<span class="comment">// 企业状态</span></div><div class="line">		</div><div class="line">		<span class="keyword">return</span> criteria;</div><div class="line">	&#125;</div></pre></td></tr></table></figure>
<p><code>Criteria</code>对象的封装。<br>实现了<code>Specification</code>接口，重写<code>public Predicate toPredicate(Root&lt;T&gt; root, CriteriaQuery&lt;?&gt; query, CriteriaBuilder builder)</code>方法。用来<strong>存储所有的查询条件</strong>。<br>下面的代码中的<code>toPredicate</code>用来<strong>构建查询条件</strong>。是<code>Criterion</code>接口中的<code>toPredicate</code></p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">List&lt;Predicate&gt; predicates = <span class="keyword">new</span> ArrayList&lt;Predicate&gt;();  </div><div class="line"><span class="keyword">for</span>(Criterion c : criterions)&#123;  </div><div class="line">    predicates.add(c.toPredicate(root, query,builder));  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><code>Criteria</code>对象完整代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> java.util.ArrayList;</div><div class="line"><span class="keyword">import</span> java.util.List;</div><div class="line"></div><div class="line"><span class="keyword">import</span> javax.persistence.criteria.CriteriaBuilder;</div><div class="line"><span class="keyword">import</span> javax.persistence.criteria.CriteriaQuery;</div><div class="line"><span class="keyword">import</span> javax.persistence.criteria.Predicate;</div><div class="line"><span class="keyword">import</span> javax.persistence.criteria.Root;</div><div class="line"></div><div class="line"><span class="keyword">import</span> org.springframework.data.jpa.domain.Specification;</div><div class="line"></div><div class="line"><span class="comment">/** </span></div><div class="line"> * Description: 查询条件的容器</div><div class="line"> * 			Predicate 为拼接好的条件或条件组合</div><div class="line"> *</div><div class="line"> * <span class="doctag">@author</span> leileiyuan</div><div class="line"> * Create Date: 2016年11月28日 上午10:50:05</div><div class="line"> * <span class="doctag">@param</span> &lt;T&gt;</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Criteria</span>&lt;<span class="title">T</span>&gt; <span class="keyword">implements</span> <span class="title">Specification</span>&lt;<span class="title">T</span>&gt; </span>&#123;</div><div class="line">	</div><div class="line">	<span class="keyword">private</span> List&lt;Criterion&gt; criterions = <span class="keyword">new</span> ArrayList&lt;Criterion&gt;();</div><div class="line">	</div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> Predicate <span class="title">toPredicate</span><span class="params">(Root&lt;T&gt; root, CriteriaQuery&lt;?&gt; query, CriteriaBuilder builder)</span> </span>&#123;</div><div class="line">		 <span class="keyword">if</span> (!criterions.isEmpty()) &#123;  </div><div class="line">	            List&lt;Predicate&gt; predicates = <span class="keyword">new</span> ArrayList&lt;Predicate&gt;();  </div><div class="line">	            <span class="keyword">for</span>(Criterion c : criterions)&#123;  </div><div class="line">	                predicates.add(c.toPredicate(root, query,builder));  </div><div class="line">	            &#125;  </div><div class="line">	            <span class="comment">// 将所有条件用 and 联合起来  </span></div><div class="line">	            <span class="keyword">if</span> (predicates.size() &gt; <span class="number">0</span>) &#123;  </div><div class="line">	                <span class="keyword">return</span> builder.and(predicates.toArray(<span class="keyword">new</span> Predicate[predicates.size()]));  </div><div class="line">	            &#125;  </div><div class="line">	        &#125;  </div><div class="line">		 	<span class="comment">// 返回一个没有联接条件的Predicate</span></div><div class="line">	        <span class="keyword">return</span> builder.conjunction();  </div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="comment">/**</span></div><div class="line">	 * Description: 增加简单的条件表达式</div><div class="line">	 *</div><div class="line">	 * <span class="doctag">@param</span> criterion</div><div class="line">	 * <span class="doctag">@author</span> leileiyuan</div><div class="line">	 * Create Date: 2015年6月25日 下午2:43:13</div><div class="line">	 */</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(Criterion criterion)</span></span>&#123;  </div><div class="line">        <span class="keyword">if</span>(criterion!=<span class="keyword">null</span>)&#123;  </div><div class="line">            criterions.add(criterion);  </div><div class="line">        &#125;  </div><div class="line">    &#125;  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><code>Criterion</code>接口代码。定义条件表达式。<br><code>toPredicate(...)</code>方法，跟<code>org.springframework.data.jpa.domain.Specification&lt;T&gt;</code>接口的<code>toPredicate</code>方法一样。用来<strong>构建条件</strong>的。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">import</span> javax.persistence.criteria.CriteriaBuilder;</div><div class="line"><span class="keyword">import</span> javax.persistence.criteria.CriteriaQuery;</div><div class="line"><span class="keyword">import</span> javax.persistence.criteria.Predicate;</div><div class="line"><span class="keyword">import</span> javax.persistence.criteria.Root;</div><div class="line"></div><div class="line"><span class="comment">/** </span></div><div class="line"> * Description: 条件表达式接口</div><div class="line"> * 				Criteria是一种类型安全和更面向对象的查询。</div><div class="line"> *</div><div class="line"> * <span class="doctag">@author</span> leileiyuan</div><div class="line"> * Create Date: 2016年11月28日 上午10:51:07</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Criterion</span> </span>&#123;</div><div class="line">	<span class="keyword">public</span> <span class="keyword">enum</span> Operator &#123;  </div><div class="line">        EQ, 		<span class="comment">// 等于				equal</span></div><div class="line">        NE, 		<span class="comment">// 不等于				notEqual</span></div><div class="line">        GT, 		<span class="comment">// 大于				greaterThan</span></div><div class="line">        LT, 		<span class="comment">// 小于				lessThan</span></div><div class="line">        GTE, 		<span class="comment">// 大于等于			greaterThanOrEqualTo</span></div><div class="line">        LTE, 		<span class="comment">// 小于等于			lessThanOrEqualTo</span></div><div class="line">        BETWEEN,	<span class="comment">// 大于等于 并且 小于等于	between</span></div><div class="line">        LIKE, 		<span class="comment">// 模糊匹配			like</span></div><div class="line">        OR,			<span class="comment">// 或者				or</span></div><div class="line">        AND			<span class="comment">// 并且				and</span></div><div class="line">    &#125;</div><div class="line">	</div><div class="line">	<span class="comment">/**</span></div><div class="line">	 * Description: 代表一个条件或多个条件的组合</div><div class="line">	 *</div><div class="line">	 * <span class="doctag">@param</span> root </div><div class="line">	 * 		代表Criteria查询的根对象，Criteria查询的查询根定义了实体类型，能为将来导航获得想要的结果</div><div class="line">	 * <span class="doctag">@param</span> query </div><div class="line">	 * 		CriteriaQuery 代表一个specific的顶层查询对象，包含查询的各个部分：如select 、from、where、group by、order by等</div><div class="line">	 * <span class="doctag">@param</span> builder </div><div class="line">	 * 		CriteriaBuilder 用来构造CriteriaQuery的构建对象</div><div class="line">	 * <span class="doctag">@return</span> Predicate 相当于条件或条件组合</div><div class="line">	 * <span class="doctag">@author</span> leileiyuan</div><div class="line">	 * Create Date: 2015年6月25日 上午11:02:31</div><div class="line">	 */</div><div class="line">    <span class="function"><span class="keyword">public</span> Predicate <span class="title">toPredicate</span><span class="params">(Root&lt;?&gt; root, CriteriaQuery&lt;?&gt; query,  </span></span></div><div class="line">            CriteriaBuilder builder);  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><code>Criterion</code>接口的实现有两个，<code>LogicalExpression</code>和<code>SimpleExpression</code>。<code>LogicalExpression</code>用来构建逻辑表达式；<code>SimpleExpression</code>用来构建简单表达式</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> java.util.ArrayList;</div><div class="line"><span class="keyword">import</span> java.util.List;</div><div class="line"></div><div class="line"><span class="keyword">import</span> javax.persistence.criteria.CriteriaBuilder;</div><div class="line"><span class="keyword">import</span> javax.persistence.criteria.CriteriaQuery;</div><div class="line"><span class="keyword">import</span> javax.persistence.criteria.Predicate;</div><div class="line"><span class="keyword">import</span> javax.persistence.criteria.Root;</div><div class="line"></div><div class="line"><span class="comment">/** </span></div><div class="line"> * Description: 逻辑表达式 ,用于复杂条件的联接 包含 AND OR </div><div class="line"> * 			形如select * from tableName where (expression1) and (expression2)</div><div class="line"> * 			and 用来连接expression1 和expression2 这里的and就是逻辑表达式</div><div class="line"> *</div><div class="line"> * <span class="doctag">@author</span> leileiyuan</div><div class="line"> * Create Date: 2016年11月28日 上午11:35:09</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LogicalExpression</span> <span class="keyword">implements</span> <span class="title">Criterion</span> </span>&#123;</div><div class="line">	<span class="keyword">private</span> Criterion[] criterions;			<span class="comment">// 逻辑表达式包含的表达式 </span></div><div class="line">	<span class="keyword">private</span> Operator operator;				<span class="comment">// 运算符</span></div><div class="line">	</div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> Predicate <span class="title">toPredicate</span><span class="params">(Root&lt;?&gt; root, CriteriaQuery&lt;?&gt; query, CriteriaBuilder builder)</span> </span>&#123;</div><div class="line">		</div><div class="line">		<span class="comment">// 存放 查询时要过滤的条件</span></div><div class="line">		List&lt;Predicate&gt;  predicates = <span class="keyword">new</span> ArrayList&lt;Predicate&gt;();</div><div class="line">		<span class="keyword">for</span> (Criterion criterion : criterions) &#123;</div><div class="line">			predicates.add(criterion.toPredicate(root, query, builder));</div><div class="line">		&#125;</div><div class="line">		</div><div class="line">		<span class="keyword">switch</span> (operator) &#123;</div><div class="line">		<span class="keyword">case</span> AND:</div><div class="line">			<span class="keyword">return</span> builder.and(predicates.toArray(<span class="keyword">new</span> Predicate[predicates.size()]));</div><div class="line">		<span class="keyword">case</span> OR:</div><div class="line">			<span class="keyword">return</span> builder.or(predicates.toArray(<span class="keyword">new</span> Predicate[predicates.size()]));</div><div class="line">		<span class="keyword">default</span>:</div><div class="line">			<span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">		&#125;</div><div class="line">		</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="title">LogicalExpression</span><span class="params">()</span> </span>&#123;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="title">LogicalExpression</span><span class="params">(Criterion[] criterions, Operator operator)</span> </span>&#123;</div><div class="line">		<span class="keyword">super</span>();</div><div class="line">		<span class="keyword">this</span>.criterions = criterions;</div><div class="line">		<span class="keyword">this</span>.operator = operator;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> javax.persistence.criteria.CriteriaBuilder;</div><div class="line"><span class="keyword">import</span> javax.persistence.criteria.CriteriaQuery;</div><div class="line"><span class="keyword">import</span> javax.persistence.criteria.Expression;</div><div class="line"><span class="keyword">import</span> javax.persistence.criteria.Path;</div><div class="line"><span class="keyword">import</span> javax.persistence.criteria.Predicate;</div><div class="line"><span class="keyword">import</span> javax.persistence.criteria.Root;</div><div class="line"></div><div class="line"><span class="comment">/** </span></div><div class="line"> * Description: 简单表达式。包括 EQ NE GT LT GTE LTE BETWEEN LIKE</div><div class="line"> *</div><div class="line"> * <span class="doctag">@author</span> leileiyuan</div><div class="line"> * Create Date: 2016年11月28日 上午11:16:58</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimpleExpression</span> <span class="keyword">implements</span> <span class="title">Criterion</span> </span>&#123;</div><div class="line">	<span class="keyword">private</span> String fieldName;			<span class="comment">// 属性名</span></div><div class="line">	<span class="keyword">private</span> Object value;           	<span class="comment">// 属性所对应的值  </span></div><div class="line">	<span class="keyword">private</span> Object value2;           	<span class="comment">// 属性所对应的值 使用在between时，第二个比较的数据值</span></div><div class="line">	<span class="keyword">private</span> Operator operator;      	<span class="comment">// 运算符</span></div><div class="line"></div><div class="line">	<span class="meta">@SuppressWarnings</span>(&#123; <span class="string">"rawtypes"</span>, <span class="string">"unchecked"</span> &#125;) </div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> Predicate <span class="title">toPredicate</span><span class="params">(Root&lt;?&gt; root, CriteriaQuery&lt;?&gt; query, CriteriaBuilder builder)</span> </span>&#123;</div><div class="line">		<span class="comment">// TODO Auto-generated method stub</span></div><div class="line">		Path expression = root.get(fieldName);</div><div class="line">		</div><div class="line">		<span class="keyword">switch</span> (operator) &#123;</div><div class="line">		<span class="keyword">case</span> EQ:</div><div class="line">			<span class="keyword">return</span> builder.equal(expression, value);</div><div class="line">		<span class="keyword">case</span> NE:</div><div class="line">			<span class="keyword">return</span> builder.notEqual(expression, value);</div><div class="line">		<span class="keyword">case</span> GT:</div><div class="line">			<span class="keyword">return</span> builder.greaterThan(expression, (Comparable) value);</div><div class="line">		<span class="keyword">case</span> LT:</div><div class="line">			<span class="keyword">return</span> builder.lessThan(expression, (Comparable) value);</div><div class="line">		<span class="keyword">case</span> GTE:</div><div class="line">			<span class="keyword">return</span> builder.greaterThanOrEqualTo(expression, (Comparable) value);</div><div class="line">		<span class="keyword">case</span> LTE:</div><div class="line">			<span class="keyword">return</span> builder.lessThanOrEqualTo(expression, (Comparable) value);</div><div class="line">		<span class="keyword">case</span> BETWEEN:</div><div class="line">			<span class="keyword">return</span> builder.between(expression, (Comparable) value, (Comparable) value2);</div><div class="line">		<span class="keyword">case</span> LIKE:</div><div class="line">			<span class="keyword">return</span> builder.like((Expression&lt;String&gt;) expression, <span class="string">"%"</span> + value +<span class="string">"%"</span>);</div><div class="line">		<span class="keyword">default</span>:</div><div class="line">			<span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="title">SimpleExpression</span><span class="params">()</span> </span>&#123;</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="title">SimpleExpression</span><span class="params">(String fieldName, Object value, Operator operator)</span> </span>&#123;</div><div class="line">		<span class="keyword">super</span>();</div><div class="line">		<span class="keyword">this</span>.fieldName = fieldName;</div><div class="line">		<span class="keyword">this</span>.value = value;</div><div class="line">		<span class="keyword">this</span>.operator = operator;</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="title">SimpleExpression</span><span class="params">(String fieldName, Object value, Object value2, Operator operator)</span> </span>&#123;</div><div class="line">		<span class="keyword">super</span>();</div><div class="line">		<span class="keyword">this</span>.fieldName = fieldName;</div><div class="line">		<span class="keyword">this</span>.value = value;</div><div class="line">		<span class="keyword">this</span>.value2 = value2;</div><div class="line">		<span class="keyword">this</span>.operator = operator;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getFieldName</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> fieldName;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFieldName</span><span class="params">(String fieldName)</span> </span>&#123;</div><div class="line">		<span class="keyword">this</span>.fieldName = fieldName;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> Object <span class="title">getValue</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> value;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setValue</span><span class="params">(Object value)</span> </span>&#123;</div><div class="line">		<span class="keyword">this</span>.value = value;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> Object <span class="title">getValue2</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> value2;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setValue2</span><span class="params">(Object value2)</span> </span>&#123;</div><div class="line">		<span class="keyword">this</span>.value2 = value2;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> Operator <span class="title">getOperator</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> operator;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setOperator</span><span class="params">(Operator operator)</span> </span>&#123;</div><div class="line">		<span class="keyword">this</span>.operator = operator;</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>逻辑表达式和简单表达式的条件构建</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> java.util.Collection;</div><div class="line"></div><div class="line"><span class="keyword">import</span> org.springframework.util.StringUtils;</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/** </span></div><div class="line"> * Description: 条件构造器</div><div class="line"> *</div><div class="line"> * <span class="doctag">@author</span> leileiyuan</div><div class="line"> * Create Date: 2016年11月28日 下午1:55:57</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Restrictions</span> </span>&#123;</div><div class="line">	<span class="comment">/**</span></div><div class="line">	 * Description: 等于</div><div class="line">	 *</div><div class="line">	 * <span class="doctag">@param</span> fieldName 属性名</div><div class="line">	 * <span class="doctag">@param</span> value		属性名对应的值</div><div class="line">	 * <span class="doctag">@return</span> </div><div class="line">	 * 		value为null返回null;</div><div class="line">	 * 		value如果是java.lang.String类型的实例 转换成String值为""，也返回null</div><div class="line">	 * <span class="doctag">@author</span> leileiyuan</div><div class="line">	 * Create Date: 2016年11月28日 下午1:59:35</div><div class="line">	 */</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> SimpleExpression <span class="title">equal</span><span class="params">(String fieldName, Object value)</span> </span>&#123;</div><div class="line">		<span class="keyword">if</span> (StringUtils.isEmpty(value)) &#123;</div><div class="line">			<span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">return</span> <span class="keyword">new</span> SimpleExpression(fieldName, value, Operator.EQ);</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="comment">/**</span></div><div class="line">	 * Description: 不等于</div><div class="line">	 *</div><div class="line">	 * <span class="doctag">@param</span> fieldName</div><div class="line">	 * <span class="doctag">@param</span> value</div><div class="line">	 * <span class="doctag">@return</span></div><div class="line">	 * <span class="doctag">@author</span> leileiyuan</div><div class="line">	 * Create Date: 2016年11月28日 下午2:04:17</div><div class="line">	 */</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> SimpleExpression <span class="title">notEqual</span><span class="params">(String fieldName, Object value)</span> </span>&#123;</div><div class="line">		<span class="keyword">if</span> (StringUtils.isEmpty(value)) &#123;</div><div class="line">			<span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">return</span> <span class="keyword">new</span> SimpleExpression(fieldName, value, Operator.NE);</div><div class="line">	&#125;</div><div class="line">	<span class="comment">/**</span></div><div class="line">	 * Description: 大于</div><div class="line">	 *</div><div class="line">	 * <span class="doctag">@param</span> fieldName</div><div class="line">	 * <span class="doctag">@param</span> value</div><div class="line">	 * <span class="doctag">@return</span></div><div class="line">	 * <span class="doctag">@author</span> leileiyuan</div><div class="line">	 * Create Date: 2016年11月28日 下午2:04:44</div><div class="line">	 */</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> SimpleExpression <span class="title">greaterThan</span><span class="params">(String fieldName, Object value)</span> </span>&#123;</div><div class="line">		<span class="keyword">if</span> (StringUtils.isEmpty(value)) &#123;</div><div class="line">			<span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">return</span> <span class="keyword">new</span> SimpleExpression(fieldName, value, Operator.GT);</div><div class="line">	&#125;</div><div class="line">	<span class="comment">/**</span></div><div class="line">	 * Description: 小于</div><div class="line">	 *</div><div class="line">	 * <span class="doctag">@param</span> fieldName</div><div class="line">	 * <span class="doctag">@param</span> value</div><div class="line">	 * <span class="doctag">@return</span></div><div class="line">	 * <span class="doctag">@author</span> leileiyuan</div><div class="line">	 * Create Date: 2016年11月28日 下午2:05:35</div><div class="line">	 */</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> SimpleExpression <span class="title">lessThan</span><span class="params">(String fieldName, Object value)</span> </span>&#123;</div><div class="line">		<span class="keyword">if</span> (StringUtils.isEmpty(value)) &#123;</div><div class="line">			<span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">return</span> <span class="keyword">new</span> SimpleExpression(fieldName, value, Operator.LT);</div><div class="line">	&#125;</div><div class="line">	<span class="comment">/**</span></div><div class="line">	 * Description: 大于等于</div><div class="line">	 *</div><div class="line">	 * <span class="doctag">@param</span> fieldName</div><div class="line">	 * <span class="doctag">@param</span> value</div><div class="line">	 * <span class="doctag">@return</span></div><div class="line">	 * <span class="doctag">@author</span> leileiyuan</div><div class="line">	 * Create Date: 2016年11月28日 下午2:07:22</div><div class="line">	 */</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> SimpleExpression <span class="title">greaterThanOrEqualTo</span><span class="params">(String fieldName, Object value)</span> </span>&#123;</div><div class="line">		<span class="keyword">if</span> (StringUtils.isEmpty(value)) &#123;</div><div class="line">			<span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">return</span> <span class="keyword">new</span> SimpleExpression(fieldName, value, Operator.GTE);</div><div class="line">	&#125;</div><div class="line">	<span class="comment">/**</span></div><div class="line">	 * Description: 小于等于</div><div class="line">	 *</div><div class="line">	 * <span class="doctag">@param</span> fieldName</div><div class="line">	 * <span class="doctag">@param</span> value</div><div class="line">	 * <span class="doctag">@return</span></div><div class="line">	 * <span class="doctag">@author</span> leileiyuan</div><div class="line">	 * Create Date: 2016年11月28日 下午2:07:57</div><div class="line">	 */</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> SimpleExpression <span class="title">lessThanOrEqualTo</span><span class="params">(String fieldName, Object value)</span> </span>&#123;</div><div class="line">		<span class="keyword">if</span> (StringUtils.isEmpty(value)) &#123;</div><div class="line">			<span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">return</span> <span class="keyword">new</span> SimpleExpression(fieldName, value, Operator.LTE);</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="comment">/**</span></div><div class="line">	 * Description: 大于等于 并且 小于等于</div><div class="line">	 *</div><div class="line">	 * <span class="doctag">@param</span> fieldName</div><div class="line">	 * <span class="doctag">@param</span> value</div><div class="line">	 * <span class="doctag">@return</span></div><div class="line">	 * <span class="doctag">@author</span> leileiyuan</div><div class="line">	 * Create Date: 2016年11月28日 下午2:08:43</div><div class="line">	 */</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> SimpleExpression <span class="title">between</span><span class="params">(String fieldName, Object value, Object value2)</span> </span>&#123;</div><div class="line">		<span class="keyword">if</span> (StringUtils.isEmpty(value)) &#123;</div><div class="line">			<span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">return</span> <span class="keyword">new</span> SimpleExpression(fieldName, value, value2, Operator.BETWEEN);</div><div class="line">	&#125;</div><div class="line">	<span class="comment">/**</span></div><div class="line">	 * Description: 模糊匹配</div><div class="line">	 *</div><div class="line">	 * <span class="doctag">@param</span> fieldName</div><div class="line">	 * <span class="doctag">@param</span> value</div><div class="line">	 * <span class="doctag">@param</span> value2</div><div class="line">	 * <span class="doctag">@return</span></div><div class="line">	 * <span class="doctag">@author</span> leileiyuan</div><div class="line">	 * Create Date: 2016年11月28日 下午2:10:04</div><div class="line">	 */</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> SimpleExpression <span class="title">like</span><span class="params">(String fieldName, Object value)</span> </span>&#123;</div><div class="line">		<span class="keyword">if</span> (StringUtils.isEmpty(value)) &#123;</div><div class="line">			<span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">return</span> <span class="keyword">new</span> SimpleExpression(fieldName, value, Operator.LIKE);</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="comment">/**</span></div><div class="line">	 * Description: 并且</div><div class="line">	 *</div><div class="line">	 * <span class="doctag">@param</span> criterions</div><div class="line">	 * <span class="doctag">@return</span></div><div class="line">	 * <span class="doctag">@author</span> leileiyuan</div><div class="line">	 * Create Date: 2016年11月28日 下午2:12:31</div><div class="line">	 */</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> LogicalExpression <span class="title">and</span><span class="params">(Criterion...criterions)</span></span>&#123;</div><div class="line">		<span class="keyword">return</span> <span class="keyword">new</span> LogicalExpression(criterions, Operator.AND);</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="comment">/**</span></div><div class="line">	 * Description: 或者</div><div class="line">	 *</div><div class="line">	 * <span class="doctag">@param</span> criterions</div><div class="line">	 * <span class="doctag">@return</span></div><div class="line">	 * <span class="doctag">@author</span> leileiyuan</div><div class="line">	 * Create Date: 2016年11月28日 下午2:13:06</div><div class="line">	 */</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> LogicalExpression <span class="title">or</span><span class="params">(Criterion...criterions)</span></span>&#123;</div><div class="line">		<span class="keyword">return</span> <span class="keyword">new</span> LogicalExpression(criterions, Operator.OR);</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="comment">/**</span></div><div class="line">	 * Description: 包含于</div><div class="line">	 *</div><div class="line">	 * <span class="doctag">@param</span> fieldName</div><div class="line">	 * <span class="doctag">@param</span> values</div><div class="line">	 * <span class="doctag">@return</span></div><div class="line">	 * <span class="doctag">@author</span> leileiyuan</div><div class="line">	 * Create Date: 2016年11月28日 下午2:21:58</div><div class="line">	 */</div><div class="line">	<span class="meta">@SuppressWarnings</span>(<span class="string">"rawtypes"</span>)</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> LogicalExpression <span class="title">in</span><span class="params">(String fieldName, Collection values)</span></span>&#123;</div><div class="line">		SimpleExpression[] ses = <span class="keyword">new</span> SimpleExpression[values.size()];</div><div class="line">		</div><div class="line">		<span class="keyword">int</span> i = <span class="number">0</span>;</div><div class="line">		<span class="keyword">for</span> (Object value : values) &#123;</div><div class="line">			ses[i] = <span class="keyword">new</span> SimpleExpression(fieldName, value, Operator.EQ);</div><div class="line">			i++;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">return</span> <span class="keyword">new</span> LogicalExpression(ses, Operator.OR);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>到此封装就基本完成了。</p>
<hr>
<p><code>spring data jpa</code>还提供了更复杂的多表联接查询<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Qfjbxxdz</span> </span>&#123;</div><div class="line">    <span class="meta">@Id</span></div><div class="line">    <span class="meta">@GeneratedValue</span>(generator = <span class="string">"system-uuid"</span>)</div><div class="line">    <span class="meta">@GenericGenerator</span>(name = <span class="string">"system-uuid"</span>, strategy = <span class="string">"uuid.hex"</span>)</div><div class="line">    <span class="keyword">private</span> String id;</div><div class="line">    <span class="meta">@OneToOne</span></div><div class="line">    <span class="meta">@JoinColumn</span>(name = <span class="string">"qfjbxx"</span>)</div><div class="line">    <span class="keyword">private</span> Qfjbxx qfjbxx; <span class="comment">//关联表</span></div><div class="line">    <span class="keyword">private</span> String fzcc;</div><div class="line">    <span class="keyword">private</span> String fzccName;</div><div class="line">    <span class="meta">@ManyToOne</span></div><div class="line">    <span class="meta">@JoinColumn</span>(name = <span class="string">"criminalInfo"</span>)</div><div class="line">    <span class="keyword">private</span> CriminalInfo criminalInfo;<span class="comment">//关联表</span></div><div class="line">    <span class="meta">@Column</span>(length=<span class="number">800</span>)</div><div class="line">    <span class="keyword">private</span> String bz;</div><div class="line">    <span class="comment">//get/set......</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>可以用类似的方法来调用。<code>qfjbxx</code>，<code>criminalInfo</code>是关联表的属性对象，<code>id</code>,<code>xm</code>分别是<code>Qfjbxx</code>和<code>CriminalInfo</code>实体类的属性</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Predicate p1 = cb.equal(root.join(<span class="string">"qfjbxx"</span>).get(<span class="string">"id"</span>).as(String.class), id);</div><div class="line">Predicate p2 = cb.like(root.join(<span class="string">"criminalInfo"</span>).get(<span class="string">"xm"</span>).as(String.class), <span class="string">"%"</span>+xm+<span class="string">"%"</span>);</div></pre></td></tr></table></figure>
<p><code>CriteriaQuery</code>对象也支持分组和排序</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 设置groupBy的条件</span></div><div class="line">query.groupBy(</div><div class="line">    root.get(<span class="string">"qid"</span>).as(String.class),</div><div class="line">    root.get(<span class="string">"fid"</span>).as(String.class)</div><div class="line">);</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 设置orderBy的条</span></div><div class="line">query.orderBy(cb.asc(root.get(<span class="string">"xm"</span>).as(String.class)));</div></pre></td></tr></table></figure>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>


    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/spring/" rel="tag"># spring</a>
          
            <a href="/tags/spring-data-jpa/" rel="tag"># spring data jpa</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2016/10/22/使用git访问远程gitub仓库/" rel="next" title="使用git访问远程gitub仓库">
                <i class="fa fa-chevron-left"></i> 使用git访问远程gitub仓库
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2016/11/15/redis分片式集群，整合spring/" rel="prev" title="redis分片式集群，整合spring">
                redis分片式集群，整合spring <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div class="ds-thread" data-thread-key="2016/10/29/spring-data-jpa-复杂条件查询/"
           data-title="spring data jpa 复杂条件查询" data-url="http://leileiyuan.top/2016/10/29/spring-data-jpa-复杂条件查询/">
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/wf.jpg"
               alt="leileiyuan" />
          <p class="site-author-name" itemprop="name">leileiyuan</p>
          <p class="site-description motion-element" itemprop="description">苟全性命于乱世，不求闻达于诸侯</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">13</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">8</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">10</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/leileiyuan" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://book.douban.com/" target="_blank" title="豆瓣阅读">
                  
                    <i class="fa fa-fw fa-book"></i>
                  
                  豆瓣阅读
                </a>
              </span>
            
          
        </div>

        
        

        
        
          <div class="links-of-blogroll motion-element links-of-blogroll-block">
            <div class="links-of-blogroll-title">
              <i class="fa  fa-fw fa-globe"></i>
              友情链接
            </div>
            <ul class="links-of-blogroll-list">
              
                <li class="links-of-blogroll-item">
                  <a href="http://ifeve.com/" title="并发编程网" target="_blank">并发编程网</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://www.roncoo.com/" title="龙果学院" target="_blank">龙果学院</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://blog.didispace.com/" title="程序猿DD|博客" target="_blank">程序猿DD|博客</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://www.itmuch.com/" title="周立" target="_blank">周立</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://blog.devtang.com/" title="唐巧的博客" target="_blank">唐巧的博客</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="https://springcloud.cc/" title="Spring Cloud中文网" target="_blank">Spring Cloud中文网</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="https://toutiao.io/" title="开发者头条" target="_blank">开发者头条</a>
                </li>
              
            </ul>
          </div>
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#一般方式"><span class="nav-number">1.</span> <span class="nav-text">一般方式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#自行封装"><span class="nav-number">2.</span> <span class="nav-text">自行封装</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2015 - 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">leileiyuan</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>


        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.0"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"leileiyuan"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    
    <script src="/lib/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  








  
  
  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length == 0) {
      search_path = "search.xml";
    }
    var path = "/" + search_path;
    // monitor main search box;

    function proceedsearch() {
      $("body").append('<div class="popoverlay">').css('overflow', 'hidden');
      $('.popup').toggle();
    }
    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';
      $.ajax({
        url: path,
        dataType: "xml",
        async: true,
        success: function( xmlResponse ) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = $( "entry", xmlResponse ).map(function() {
            return {
              title: $( "title", this ).text(),
              content: $("content",this).text(),
              url: $( "url" , this).text()
            };
          }).get();
          var $input = document.getElementById(search_id);
          var $resultContent = document.getElementById(content_id);
          $input.addEventListener('input', function(){
            var matchcounts = 0;
            var str='<ul class=\"search-result-list\">';
            var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
            $resultContent.innerHTML = "";
            if (this.value.trim().length > 1) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var content_index = [];
                var data_title = data.title.trim().toLowerCase();
                var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                var data_url = decodeURIComponent(data.url);
                var index_title = -1;
                var index_content = -1;
                var first_occur = -1;
                // only match artiles with not empty titles and contents
                if(data_title != '') {
                  keywords.forEach(function(keyword, i) {
                    index_title = data_title.indexOf(keyword);
                    index_content = data_content.indexOf(keyword);
                    if( index_title >= 0 || index_content >= 0 ){
                      isMatch = true;
                      if (i == 0) {
                        first_occur = index_content;
                      }
                    }

                  });
                }
                // show search results
                if (isMatch) {
                  matchcounts += 1;
                  str += "<li><a href='"+ data_url +"' class='search-result-title'>"+ data_title +"</a>";
                  var content = data.content.trim().replace(/<[^>]+>/g,"");
                  if (first_occur >= 0) {
                    // cut out 100 characters
                    var start = first_occur - 20;
                    var end = first_occur + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if(start == 0){
                      end = 50;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    var match_content = content.substring(start, end);
                    // highlight all keywords
                    keywords.forEach(function(keyword){
                      var regS = new RegExp(keyword, "gi");
                      match_content = match_content.replace(regS, "<b class=\"search-keyword\">"+keyword+"</b>");
                    });

                    str += "<p class=\"search-result\">" + match_content +"...</p>"
                  }
                  str += "</li>";
                }
              })};
            str += "</ul>";
            if (matchcounts == 0) { str = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>' }
            if (keywords == "") { str = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>' }
            $resultContent.innerHTML = str;
          });
          proceedsearch();
        }
      });}

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched == false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(function(e){
      $('.popup').hide();
      $(".popoverlay").remove();
      $('body').css('overflow', '');
    });
    $('.popup').click(function(e){
      e.stopPropagation();
    });
  </script>


  

  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
  <script>AV.initialize("zo3n9YB7iFWcc81aIVwoFTBV-gzGzoHsz", "NliPe7LaMjCX3ixiCPpu2Lrj");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  


</body>
</html>
